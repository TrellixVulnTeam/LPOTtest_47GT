

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Building the LoadGen {#ReadmeBuild} &mdash; Intel® Low Precision Optimization Tool  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> Intel® Low Precision Optimization Tool
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../welcome.html">Introduction to Intel LPOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../docs/introduction.html">APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../readme.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../docs/doclist.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../releases-info.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../CONTRIBUTING.html">Contributing Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../CODE_OF_CONDUCT.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../legal_information.html">Legal Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../SECURITY.html">Security Policy</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Intel® Low Precision Optimization Tool</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Building the LoadGen {#ReadmeBuild}</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../_sources/examples/pytorch/speech_recognition/inference/loadgen/README_BUILD.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-the-loadgen-readmebuild">
<h1>Building the LoadGen {#ReadmeBuild}<a class="headerlink" href="#building-the-loadgen-readmebuild" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libglib2</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">dev</span> <span class="n">python</span><span class="o">-</span><span class="n">pip</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span>
<span class="n">pip2</span> <span class="n">install</span> <span class="n">absl</span><span class="o">-</span><span class="n">py</span> <span class="n">numpy</span>
<span class="n">pip3</span> <span class="n">install</span> <span class="n">absl</span><span class="o">-</span><span class="n">py</span> <span class="n">numpy</span>
</pre></div>
</div>
</div>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">absl</span><span class="o">-</span><span class="n">py</span> <span class="n">numpy</span>
<span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recurse</span><span class="o">-</span><span class="n">submodules</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">mlperf</span><span class="o">/</span><span class="n">inference</span><span class="o">.</span><span class="n">git</span> <span class="n">mlperf_inference</span>
<span class="n">cd</span> <span class="n">mlperf_inference</span><span class="o">/</span><span class="n">loadgen</span>
<span class="n">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-std=c++14 -O3&quot;</span> <span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">bdist_wheel</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">force</span><span class="o">-</span><span class="n">reinstall</span> <span class="n">dist</span><span class="o">/</span><span class="n">mlperf_loadgen</span><span class="o">-</span><span class="mf">0.5</span><span class="n">a0</span><span class="o">-</span><span class="n">cp36</span><span class="o">-</span><span class="n">cp36m</span><span class="o">-</span><span class="n">linux_x86_64</span><span class="o">.</span><span class="n">whl</span>
<span class="n">python</span> <span class="n">demos</span><span class="o">/</span><span class="n">py_demo_single_stream</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This will fetch the loadgen source, build and install the loadgen as a python module, and run a simple end-to-end demo. The exact *.whl filename may differ on your system, but there should only be one resulting whl file for you to use.</p>
<p>A summary of the test results can be found in the <em>“mlperf_log_summary.txt”</em> logfile.</p>
<p>For a timeline visualization of what happened during the test, open the <em>“mlperf_log_trace.json”</em> file in Chrome:</p>
<ul class="simple">
<li><p>Type “chrome://tracing” in the address bar, then drag-n-drop the json.</p></li>
<li><p>This may be useful for SUT performance tuning and understanding + debugging the loadgen.</p></li>
</ul>
<p>To build the loadgen as a C++ library, rather than a python module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recurse</span><span class="o">-</span><span class="n">submodules</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">mlperf</span><span class="o">/</span><span class="n">inference</span><span class="o">.</span><span class="n">git</span> <span class="n">mlperf_inference</span>
<span class="n">cd</span> <span class="n">mlperf_inference</span>
<span class="n">make</span> <span class="n">mlperf_loadgen</span>
<span class="n">cp</span> <span class="n">out</span><span class="o">/</span><span class="n">MakefileGnProj</span><span class="o">/</span><span class="n">obj</span><span class="o">/</span><span class="n">loadgen</span><span class="o">/</span><span class="n">libmlperf_loadgen</span><span class="o">.</span><span class="n">a</span> <span class="o">.</span>
</pre></div>
</div>
<p>Alternatively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">mlperf</span><span class="o">/</span><span class="n">inference</span><span class="o">.</span><span class="n">git</span> <span class="n">mlperf_inference</span>
<span class="n">cd</span> <span class="n">mlperf_inference</span>
<span class="n">mkdir</span> <span class="n">loadgen</span><span class="o">/</span><span class="n">build</span><span class="o">/</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">loadgen</span><span class="o">/</span><span class="n">build</span><span class="o">/</span>
<span class="n">cmake</span> <span class="o">..</span> <span class="o">&amp;&amp;</span> <span class="n">cmake</span> <span class="o">--</span><span class="n">build</span> <span class="o">.</span>
<span class="n">cp</span> <span class="n">libmlperf_loadgen</span><span class="o">.</span><span class="n">a</span> <span class="o">..</span>
</pre></div>
</div>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The load generator is built using the
<a class="reference external" href="https://gn.googlesource.com/gn/+/master">gn metabuild</a>
and <a class="reference external" href="https://ninja-build.org/">ninja build</a> tools.</p>
<p>Using git submodules to manage a checkout will compile gn and ninja if needed.
Using depot_tools to manage a checkout will include prebuilt versions of gn and ninja.
By default, both ways will use the system C++ compiler, however depot_tools also
has the option to use versioned compiler binaries.</p>
<p>If the tools above don’t cover your particular configuration, please reach out.
Patches to support other build environments welcome.</p>
</div>
<div class="section" id="git-submodules-approach">
<h2>Git Submodules Approach<a class="headerlink" href="#git-submodules-approach" title="Permalink to this headline">¶</a></h2>
<div class="section" id="downloading-the-source">
<h3>Downloading the source<a class="headerlink" href="#downloading-the-source" title="Permalink to this headline">¶</a></h3>
<p>Download the mlperf inference repository and its submodules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recurse</span><span class="o">-</span><span class="n">submodules</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">mlperf</span><span class="o">/</span><span class="n">inference</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</div>
<div class="section" id="build-from-source">
<h3>Build from source<a class="headerlink" href="#build-from-source" title="Permalink to this headline">¶</a></h3>
<div class="section" id="just-building-once">
<h4>Just building once<a class="headerlink" href="#just-building-once" title="Permalink to this headline">¶</a></h4>
<p>The following is a phony Makefile target, wrapping everything needed to build
the load generator. It’ll get the job done, but will result in lots of redundant
work if used over and over again, so isn’t recommended for development.
The resulting binary will be found in: out/MakefileGnProj/obj/loadgen/libmlperf_loadgen.*</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">mlperf_loadgen</span>
</pre></div>
</div>
<p>To build the python module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">mlperf_loadgen_pymodule</span>
</pre></div>
</div>
<p>Note: These make targets assume Unix-like shell commands are available.</p>
</div>
<div class="section" id="building-for-development-purposes">
<h4>Building for development purposes<a class="headerlink" href="#building-for-development-purposes" title="Permalink to this headline">¶</a></h4>
<p>The bootstrap_gn_ninja make target will build ninja and gn into the current
tree and should only need to be called once per checkout.
This is not necessary if you already have gn and ninja installed on your
system.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">bootstrap_gn_ninja</span>
</pre></div>
</div>
<p>Then generate the ninja build files from the gn build files.
You can have multiple sets of ninja build files in different out directories,
each with their own args. Release and debug sets, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">third_party</span><span class="o">/</span><span class="n">gn</span><span class="o">/</span><span class="n">gn</span> <span class="n">gen</span> <span class="n">out</span><span class="o">/</span><span class="n">Release</span> <span class="o">--</span><span class="n">args</span><span class="o">=</span><span class="s2">&quot;is_debug=false&quot;</span>
<span class="n">third_party</span><span class="o">/</span><span class="n">gn</span><span class="o">/</span><span class="n">gn</span> <span class="n">gen</span> <span class="n">out</span><span class="o">/</span><span class="n">Debug</span> <span class="o">--</span><span class="n">args</span><span class="o">=</span><span class="s2">&quot;is_debug=true&quot;</span>
</pre></div>
</div>
<p>From here you can edit+build over and over using one of the following targets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">third_party</span><span class="o">/</span><span class="n">ninja</span><span class="o">/</span><span class="n">ninja</span> <span class="o">-</span><span class="n">C</span> <span class="n">out</span><span class="o">/</span><span class="n">Release</span> <span class="n">mlperf_loadgen</span>
<span class="n">third_party</span><span class="o">/</span><span class="n">ninja</span><span class="o">/</span><span class="n">ninja</span> <span class="o">-</span><span class="n">C</span> <span class="n">out</span><span class="o">/</span><span class="n">Release</span> <span class="n">loadgen_pymodule_wheel_src</span>
</pre></div>
</div>
<p>You will find the binary in <em>“out/Release/obj/loadgen/libmlperf_loadgen.a”</em>. (Or as a .lib on Windows).</p>
<p>Link that library directly into the executable you want to test.</p>
<p>Optionally, create a project file for your favorite IDE.
See <a class="reference external" href="https://gn.googlesource.com/gn/+/master/docs/reference.md#ide-options">gn documentation</a> for details.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gn</span> <span class="n">gen</span> <span class="o">--</span><span class="n">root</span><span class="o">=</span><span class="n">src</span> <span class="o">--</span><span class="n">ide</span><span class="o">=</span><span class="n">eclipse</span> <span class="n">out</span><span class="o">/</span><span class="n">Release</span>
<span class="n">gn</span> <span class="n">gen</span> <span class="o">--</span><span class="n">root</span><span class="o">=</span><span class="n">src</span> <span class="o">--</span><span class="n">ide</span><span class="o">=</span><span class="n">vs</span> <span class="n">out</span><span class="o">/</span><span class="n">Release</span>
<span class="n">gn</span> <span class="n">gen</span> <span class="o">--</span><span class="n">root</span><span class="o">=</span><span class="n">src</span> <span class="o">--</span><span class="n">ide</span><span class="o">=</span><span class="n">xcode</span> <span class="n">out</span><span class="o">/</span><span class="n">Release</span>
<span class="n">gn</span> <span class="n">gen</span> <span class="o">--</span><span class="n">root</span><span class="o">=</span><span class="n">src</span> <span class="o">--</span><span class="n">ide</span><span class="o">=</span><span class="n">qtcreator</span> <span class="n">out</span><span class="o">/</span><span class="n">Release</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="depot-tools-approach">
<h2>Depot Tools approach<a class="headerlink" href="#depot-tools-approach" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Downloading the source<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Download and install depot_tools:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="s1">&#39;https://chromium.googlesource.com/chromium/tools/depot_tools.git&#39;</span>
<span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{PWD}</span><span class="s2">/depot_tools:$</span><span class="si">{PATH}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Copy the depot_tools fetch config for the MLPerf load generator to the
depot_tools path:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>wget https://raw.githubusercontent.com/mlperf/inference/master/loadgen/depot_tools/fetch_configs/mlperf_loadgen.py \
-O ${PWD}/depot_tools/fetch_configs/mlperf_loadgen.py
</pre></div>
</div>
<p>Create a folder for the load generator project and fetch the source code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">mlperf_loadgen</span>
<span class="n">cd</span> <span class="n">mlperf_loadgen</span>
<span class="n">fetch</span> <span class="n">mlperf_loadgen</span>
<span class="n">gclient</span> <span class="n">sync</span>
</pre></div>
</div>
</div>
<div class="section" id="building-from-source">
<h3>Building from source<a class="headerlink" href="#building-from-source" title="Permalink to this headline">¶</a></h3>
<p>The depot_tools approach enables building with versioned toolchains.</p>
<p><i>Note: This has only been tested to work in a Debian-based linux environment so
far, but it should support many others.</i></p>
<p>Run the gn metabuild. The output directory will contain ninja build files for a
specific target platform and set of build options.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gn</span> <span class="n">gen</span> <span class="o">--</span><span class="n">root</span><span class="o">=</span><span class="n">src</span> <span class="n">out</span><span class="o">/</span><span class="n">Default</span>
</pre></div>
</div>
<p>TODO: Provide gn commands for cross-compiling to Android and to iOS. In the mean
time, looking at how to build chromium
<a class="reference external" href="https://chromium.googlesource.com/chromium/src/+/master/docs/android_build_instructions.md">for android</a>
or <a class="reference external" href="https://chromium.googlesource.com/chromium/src/+/HEAD/docs/ios/build_instructions.md">for ios</a>
should provide some useful pointers.</p>
<p>Build the library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ninja</span> <span class="o">-</span><span class="n">C</span> <span class="n">out</span><span class="o">/</span><span class="n">Default</span> <span class="n">mlperf_loadgen</span>
</pre></div>
</div>
<p>You will find the binary in <em>“out/Release/obj/loadgen/libmlperf_loadgen.a”</em>. (Or as a .lib on Windows).</p>
<p>Link that library directly into the executable you want to test.</p>
</div>
</div>
<div class="section" id="notes-about-important-dependency-and-build-files">
<h2>Notes about important dependency and build files<a class="headerlink" href="#notes-about-important-dependency-and-build-files" title="Permalink to this headline">¶</a></h2>
<p><strong>DEPS</strong>: Describes source repositories to pull in as dependencies depot_tools’
“gclient sync” command. Also runs system commands to download the relevant toolchains
for the “gclient runhooks” command, which is run as part of the initial “fetch”.</p>
<p><strong>.gitmodules</strong>: Git submodules alternative to DEPS.</p>
<p><strong>.gn</strong>: The root gn build file.</p>
<p><strong>BUILD.gn</strong>: Located in multiple directories. Each one describes how to build
that particular directory.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Intel® LPOT.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>